{% extends "base.html" %}
{% block title %}Guestbook — Home{% endblock %}
{% block content %}
  <h1>Guestbook</h1>

  <form method="get" action="{{ url_for('home') }}" class="search">
    <input name="q" placeholder="Cerca..." value="{{ q or '' }}">
    <button type="submit">Cerca</button>
  </form>

  <p class="muted">Visite in questa sessione: {{ visits }}</p>

  <ul class="list">
    {% for m in messages %}
      <li>
        <a href="{{ url_for('show_message', msg_id=m.id) }}">#{{ m.id }}</a>
        <strong>{{ m.author }}</strong> — {{ m.text|truncate_italian(80) }}
      </li>
    {% else %}
      <li class="muted">Nessun messaggio.</li>
    {% endfor %}
  </ul>

  {% set pages = (total // per_page) + (1 if total % per_page else 0) %}
  {% if pages > 1 %}
    <nav aria-label="pagination" class="pagination">
      {% for p in range(1, pages + 1) %}
        {% if p == page %}
          <span class="current">{{ p }}</span>
        {% else %}
          <a href="{{ url_for('home', page=p, q=q) }}">{{ p }}</a>
        {% endif %}
      {% endfor %}
    </nav>
  {% endif %}
{% endblock %}

